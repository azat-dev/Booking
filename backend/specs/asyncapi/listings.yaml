asyncapi: 3.0.0
info:
  title: Listings Microservice Kafka API
  version: 1.0.0
defaultContentType: application/json
channels:
  listingEventsStream:
    address: 'com.azat4dev.booking.listings.events.listing_events_stream'
    messages:
      NewListingAdded:
        $ref: '#/components/messages/events~1NewListingAdded'
      FailedToAddNewListing:
        $ref: '#/components/messages/events~1FailedToAddNewListing'
      ListingDetailsUpdated:
        $ref: '#/components/messages/events~1ListingDetailsUpdated'
      ListingPublished:
        $ref: '#/components/messages/events~1ListingPublished'
      GeneratedUrlForUploadListingPhoto:
        $ref: '#/components/messages/events~1GeneratedUrlForUploadListingPhoto'
      FailedGenerateUrlForUploadListingPhoto:
        $ref: '#/components/messages/events~1FailedGenerateUrlForUploadListingPhoto'
      AddedNewPhotoToListing:
        $ref: '#/components/messages/events~1AddedNewPhotoToListing'

  queries/requests/GetPublicListingDetailsById:
    address: 'com.azat4dev.booking.listings.1.0.queries.get_public_listing_details_by_id'
    messages:
      GetPublicListingDetailsById:
        $ref: '#/components/messages/queries~1requests~1GetPublicListingDetailsById'

  queries/responses/GetPublicListingDetailsById:
    address: 'com.azat4dev.booking.listings.responses.get_public_listing_details_by_id'
    messages:
      GetPublicListingDetailsById:
        $ref: '#/components/messages/queries~1responses~1GetPublicListingDetailsById'

operations:
  queriesGetPublicListingDetailsById:
    action: receive
    channel:
      $ref: '#/channels/queries~1requests~1GetPublicListingDetailsById'
    reply:
      channel:
        $ref: '#/channels/queries~1responses~1GetPublicListingDetailsById'
      messages:
        - $ref: '#/components/messages/queries~1responses~1GetPublicListingDetailsById'

  sendListingEvents:
    action: send
    channel:
      $ref: '#/channels/listingEventsStream'
    messages:
      - $ref: '#/channels/listingEventsStream/messages/NewListingAdded'
      - $ref: '#/channels/listingEventsStream/messages/FailedToAddNewListing'
      - $ref: '#/channels/listingEventsStream/messages/ListingDetailsUpdated'
      - $ref: '#/channels/listingEventsStream/messages/ListingPublished'
      - $ref: '#/channels/listingEventsStream/messages/GeneratedUrlForUploadListingPhoto'
      - $ref: '#/channels/listingEventsStream/messages/FailedGenerateUrlForUploadListingPhoto'
      - $ref: '#/channels/listingEventsStream/messages/AddedNewPhotoToListing'

components:
  messages:
    queries/requests/GetPublicListingDetailsById:
      name: GetPublicListingDetailsById
      payload:
        $ref: '#/components/schemas/queries/GetPublicListingDetailsById'

    queries/responses/GetPublicListingDetailsById:
      name: GetPublicListingDetailsById
      payload:
        $ref: '#/components/schemas/queries/GetPublicListingDetailsByIdResponse'

    events/NewListingAdded:
      name: NewListingAdded
      payload:
        $ref: '#/components/schemas/payloads/NewListingAdded'

    events/FailedToAddNewListing:
      name: FailedToAddNewListing
      payload:
        $ref: '#/components/schemas/payloads/FailedToAddNewListing'

    events/ListingDetailsUpdated:
      name: ListingDetailsUpdated
      payload:
        $ref: '#/components/schemas/payloads/ListingDetailsUpdated'

    events/ListingPublished:
      name: ListingPublished
      payload:
        $ref: '#/components/schemas/payloads/ListingPublished'

    events/GeneratedUrlForUploadListingPhoto:
      name: GeneratedUrlForUploadListingPhoto
      payload:
        $ref: '#/components/schemas/payloads/GeneratedUrlForUploadListingPhoto'

    events/FailedGenerateUrlForUploadListingPhoto:
      name: FailedGenerateUrlForUploadListingPhoto
      payload:
        $ref: '#/components/schemas/payloads/FailedGenerateUrlForUploadListingPhoto'

    events/AddedNewPhotoToListing:
      name: AddedNewPhotoToListing
      payload:
        $ref: '#/components/schemas/payloads/AddedNewPhotoToListing'

  schemas:
    values:
      UserId:
        title: UserId
        type: string
        format: uuid
      FullName:
        title: FullName
        type: object
        required:
          - firstName
          - lastName
        properties:
          firstName:
            type: string
          lastName:
            type: string

      ListingStatus:
        title: ListingStatus
        type: string
        enum:
          - PUBLISHED
          - DRAFT
          - READY_FOR_PUBLISHING

      RoomType:
        title: RoomType
        type: string
        enum:
          - ENTIRE_PLACE
          - PRIVATE_ROOM
          - SHARED_ROOM

      PropertyType:
        title: PropertyType
        type: string
        additionalProperties: false
        enum:
          - APARTMENT
          - HOUSE
          - VILLA
          - CABIN
          - COTTAGE
          - CHALET
          - BUNGALOW
          - TOWNHOUSE
          - GUESTHOUSE
          - LOFT
          - HOSTEL
          - BOAT
          - BED_AND_BREAKFAST
          - OTHER

      UploadFileFormData:
        title: UploadFileFormData
        type: object
        additionalProperties: false
        required:
          - url
          - bucketName
          - objectName
          - fields
        properties:
          url:
            type: string
            format: uri
          bucketName:
            type: string
          objectName:
            type: string
          fields:
            type: object
            additionalProperties:
              type: string
      Address:
        title: Address
        type: object
        additionalProperties: false
        required:
          - country
          - city
          - street
        properties:
          street:
            type: string
          city:
            type: string
          state:
            type: string
          country:
            type: string

      GuestsCapacity:
        title: GuestsCapacity
        type: object
        additionalProperties: false
        required:
          - adults
          - children
          - infants
        properties:
          adults:
            type: integer
          children:
            type: integer
          infants:
            type: integer

      ListingDetailsFields:
        title: ListingDetailsFields
        type: object
        additionalProperties: false
        properties:
          status:
            $ref: "#/components/schemas/values/ListingStatus"
          title:
            type: string
          description:
            type: string
          guestCapacity:
            $ref: "#/components/schemas/values/GuestsCapacity"
          propertyType:
            $ref: "#/components/schemas/values/PropertyType"
          roomType:
            $ref: "#/components/schemas/values/RoomType"
          address:
            $ref: "#/components/schemas/values/Address"

      UploadedFileData:
        title: UploadedFileData
        type: object
        additionalProperties: false
        required:
          - bucketName
          - objectName
        properties:
          bucketName:
            type: string
          objectName:
            type: string

      ListingPhoto:
        title: ListingPhoto
        type: object
        additionalProperties: false
        required:
          - id
          - bucketName
          - objectName
        properties:
          id:
            type: string
          bucketName:
            type: string
          objectName:
            type: string

      PublicListingDetails:
        title: PublicListingDetails
        type: object
        additionalProperties: false
        required:
          - listingId
          - title
          - description
          - address
          - roomType
          - propertyType
          - guestCapacity
          - photos
          - status
        properties:
          listingId:
            $ref: "./common/values.yaml#/components/schemas/ListingId"
          title:
            type: string
          description:
            type: string
          address:
            $ref: "#/components/schemas/values/Address"
          roomType:
            $ref: "#/components/schemas/values/RoomType"
          propertyType:
            $ref: "#/components/schemas/values/PropertyType"
          guestCapacity:
            $ref: "#/components/schemas/values/GuestsCapacity"
          photos:
            type: array
            items:
              $ref: "#/components/schemas/values/ListingPhoto"
          status:
            $ref: "#/components/schemas/values/ListingStatus"

    payloads:
      NewListingAdded:
        title: NewListingAdded
        type: object
        additionalProperties: false
        required:
          - hostId
          - listingId
          - title
        properties:
          operationId:
            $ref: "./common/values.yaml#/components/schemas/OperationId"
          hostId:
            $ref: "./common/values.yaml#/components/schemas/HostId"
          listingId:
            $ref: "./common/values.yaml#/components/schemas/ListingId"
          title:
            type: string

      FailedToAddNewListing:
        title: FailedToAddNewListing
        type: object
        additionalProperties: false
        required:
          - hostId
          - listingId
          - title
        properties:
          hostId:
            $ref: "./common/values.yaml#/components/schemas/HostId"
          listingId:
            $ref: "./common/values.yaml#/components/schemas/ListingId"
          title:
            type: string

      GeneratedUrlForUploadListingPhoto:
        title: GeneratedUrlForUploadListingPhoto
        type: object
        additionalProperties: false
        required:
          - userId
          - listingId
          - formData
        properties:
          operationId:
            $ref: "./common/values.yaml#/components/schemas/OperationId"
          userId:
            $ref: "./common/values.yaml#/components/schemas/UserId"
          listingId:
            $ref: "./common/values.yaml#/components/schemas/ListingId"
          formData:
            $ref: "#/components/schemas/values/UploadFileFormData"

      FailedGenerateUrlForUploadListingPhoto:
        title: FailedGenerateUrlForUploadListingPhoto
        type: object
        additionalProperties: false
        required:
          - operationId
          - userId
          - listingId
          - fileExtension
          - fileSize
        properties:
          operationId:
            $ref: "./common/values.yaml#/components/schemas/OperationId"
          userId:
            $ref: "./common/values.yaml#/components/schemas/UserId"
          listingId:
            $ref: "./common/values.yaml#/components/schemas/ListingId"
          fileExtension:
            type: string
          fileSize:
            type: integer

      AddedNewPhotoToListing:
        title: AddedNewPhotoToListing
        type: object
        additionalProperties: false
        required:
          - listingId
          - photo
        properties:
          listingId:
            $ref: "./common/values.yaml#/components/schemas/ListingId"
          photo:
            $ref: "#/components/schemas/values/ListingPhoto"

      ListingPublished:
        title: ListingPublished
        type: object
        additionalProperties: false
        required:
          - listingId
          - publishedAt
        properties:
          listingId:
            $ref: "./common/values.yaml#/components/schemas/ListingId"
          publishedAt:
            type: string
            format: date-time

      ListingDetailsUpdated:
        title: ListingDetailsUpdated
        type: object
        additionalProperties: false
        required:
          - listingId
          - updatedAt
          - prevValues
          - newValues
        properties:
          listingId:
            $ref: "./common/values.yaml#/components/schemas/ListingId"
          updatedAt:
            type: string
            format: date-time
          prevValues:
            $ref: "#/components/schemas/values/ListingDetailsFields"
          newValues:
            $ref: "#/components/schemas/values/ListingDetailsFields"

    queries:
      GetPublicListingDetailsById:
        title: GetPublicListingDetailsById
        type: object
        additionalProperties: false
        required:
          - correlationId
          - params
        properties:
          correlationId:
            type: string
          params:
            $ref: "#/components/schemas/queries/GetPublicListingDetailsByIdParams"

      GetPublicListingDetailsByIdParams:
        title: GetPublicListingDetailsByIdParams
        type: object
        additionalProperties: false
        required:
          - listingId
        properties:
          listingId:
            $ref: "./common/values.yaml#/components/schemas/ListingId"

      GetPublicListingDetailsByIdResponse:
        title: GetPublicListingDetailsByIdResponse
        type: object
        additionalProperties: false
        required:
          - correlationId
          - params
          - data
        properties:
          correlationId:
            type: string
          params:
            $ref: "#/components/schemas/queries/GetPublicListingDetailsByIdParams"
          data:
            $ref: "#/components/schemas/values/PublicListingDetails"